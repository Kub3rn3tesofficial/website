---
title: 使用 kubeadm 進行證書管理
content_type: task
weight: 10
---
<!--
reviewers:
- sig-cluster-lifecycle
title: Certificate Management with kubeadm
content_type: task
weight: 10
-->

<!-- overview -->

{{< feature-state for_k8s_version="v1.15" state="stable" >}}

<!--
Client certificates generated by [kubeadm](/docs/reference/setup-tools/kubeadm/) expire after 1 year.
This page explains how to manage certificate renewals with kubeadm. It also covers other tasks related
to kubeadm certificate management.
-->
由 [kubeadm](/zh-cn/docs/reference/setup-tools/kubeadm/) 生成的客戶端證書在 1 年後到期。
本頁說明如何使用 kubeadm 管理證書續訂，同時也涵蓋其他與 kubeadm 證書管理相關的說明。

## {{% heading "prerequisites" %}}

<!--
You should be familiar with [PKI certificates and requirements in Kubernetes](/docs/setup/best-practices/certificates/).
-->
你應該熟悉 [Kubernetes 中的 PKI 證書和要求](/zh-cn/docs/setup/best-practices/certificates/)。

<!-- steps -->

<!--
## Using custom certificates {#custom-certificates}

By default, kubeadm generates all the certificates needed for a cluster to run.
You can override this behavior by providing your own certificates.
-->

## 使用自定義的證書 {#custom-certificates}

預設情況下，kubeadm 會生成執行一個叢集所需的全部證書。
你可以透過提供你自己的證書來改變這個行為策略。

<!--
To do so, you must place them in whatever directory is specified by the
`--cert-dir` flag or the `certificatesDir` field of kubeadm's `ClusterConfiguration`.
By default this is `/etc/kubernetes/pki`.
-->
如果要這樣做，你必須將證書檔案放置在透過 `--cert-dir` 命令列引數或者 kubeadm 配置中的
`certificatesDir` 配置項指明的目錄中。預設的值是 `/etc/kubernetes/pki`。

<!--
If a given certificate and private key pair exists before running `kubeadm init`,
kubeadm does not overwrite them. This means you can, for example, copy an existing
CA into `/etc/kubernetes/pki/ca.crt` and `/etc/kubernetes/pki/ca.key`,
and kubeadm will use this CA for signing the rest of the certificates.
-->
如果在執行 `kubeadm init` 之前存在給定的證書和私鑰對，kubeadm 將不會重寫它們。
例如，這意味著你可以將現有的 CA 複製到 `/etc/kubernetes/pki/ca.crt` 和
`/etc/kubernetes/pki/ca.key` 中，而 kubeadm 將使用此 CA 對其餘證書進行簽名。

<!--
## External CA mode {#external-ca-mode}

It is also possible to provide only the `ca.crt` file and not the
`ca.key` file (this is only available for the root CA file, not other cert pairs).
If all other certificates and kubeconfig files are in place, kubeadm recognizes
this condition and activates the "External CA" mode. kubeadm will proceed without the
CA key on disk.
-->

## 外部 CA 模式 {#external-ca-mode}

只提供了 `ca.crt` 檔案但是不提供 `ca.key` 檔案也是可以的
（這隻對 CA 根證書可用，其它證書不可用）。
如果所有的其它證書和 kubeconfig 檔案已就緒，kubeadm 檢測到滿足以上條件就會啟用
"外部 CA" 模式。kubeadm 將會在沒有 CA 金鑰檔案的情況下繼續執行。

<!--
Instead, run the controller-manager standalone with `--controllers=csrsigner` and
point to the CA certificate and key.
-->
否則，kubeadm 將獨立執行 controller-manager，附加一個
`--controllers=csrsigner` 的引數，並且指明 CA 證書和金鑰。

<!--
[PKI certificates and requirements](/docs/setup/best-practices/certificates/) includes guidance on
setting up a cluster to use an external CA.
-->
[PKI 證書和要求](/zh-cn/docs/setup/best-practices/certificates/)包括叢集使用外部 CA 的設定指南。

<!--
## Check certificate expiration

You can use the `check-expiration` subcommand to check when certificates expire:
-->
## 檢查證書是否過期 {#check-certificate-expiration}

你可以使用 `check-expiration` 子命令來檢查證書何時過期

```shell
kubeadm certs check-expiration
```

<!--
The output is similar to this:
-->
輸出類似於以下內容：

```
CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED
admin.conf                 Dec 30, 2020 23:36 UTC   364d                                    no
apiserver                  Dec 30, 2020 23:36 UTC   364d            ca                      no
apiserver-etcd-client      Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
apiserver-kubelet-client   Dec 30, 2020 23:36 UTC   364d            ca                      no
controller-manager.conf    Dec 30, 2020 23:36 UTC   364d                                    no
etcd-healthcheck-client    Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
etcd-peer                  Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
etcd-server                Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
front-proxy-client         Dec 30, 2020 23:36 UTC   364d            front-proxy-ca          no
scheduler.conf             Dec 30, 2020 23:36 UTC   364d                                    no

CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED
ca                      Dec 28, 2029 23:36 UTC   9y              no
etcd-ca                 Dec 28, 2029 23:36 UTC   9y              no
front-proxy-ca          Dec 28, 2029 23:36 UTC   9y              no
```

<!--
The command shows expiration/residual time for the client certificates in the `/etc/kubernetes/pki` folder and for the client certificate embedded in the KUBECONFIG files used by kubeadm (`admin.conf`, `controller-manager.conf` and `scheduler.conf`).
-->
該命令顯示 `/etc/kubernetes/pki` 資料夾中的客戶端證書以及
kubeadm（`admin.conf`、`controller-manager.conf` 和 `scheduler.conf`）
使用的 KUBECONFIG 檔案中嵌入的客戶端證書的到期時間/剩餘時間。

<!--
Additionally, kubeadm informs the user if the certificate is externally managed; in this case, the user should take care of managing certificate renewal manually/using other tools.
-->
另外，kubeadm 會通知使用者證書是否由外部管理；
在這種情況下，使用者應該小心的手動/使用其他工具來管理證書更新。

<!--
`kubeadm` cannot manage certificates signed by an external CA.
 -->
{{< warning >}}
`kubeadm` 不能管理由外部 CA 簽名的證書
{{< /warning >}}

<!--
`kubelet.conf` is not included in the list above because kubeadm configures kubelet
for [automatic certificate renewal](/docs/tasks/tls/certificate-rotation/)
with rotatable certificates under `/var/lib/kubelet/pki`.
To repair an expired kubelet client certificate see
[Kubelet client certificate rotation fails](/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/#kubelet-client-cert).
-->
{{< note >}}
上面的列表中沒有包含 `kubelet.conf`，因為 kubeadm 將 kubelet 配置為
[自動更新證書](/zh-cn/docs/tasks/tls/certificate-rotation/)。
輪換的證書位於目錄 `/var/lib/kubelet/pki`。
要修復過期的 kubelet 客戶端證書，請參閱
[kubelet 客戶端證書輪換失敗](/zh-cn/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/#kubelet-client-cert)。
{{< /note >}}

<!--
On nodes created with `kubeadm init`, prior to kubeadm version 1.17, there is a
[bug](https://github.com/kubernetes/kubeadm/issues/1753) where you manually have to modify the contents of `kubelet.conf`. After `kubeadm init` finishes, you should update `kubelet.conf` to point to the
rotated kubelet client certificates, by replacing `client-certificate-data` and `client-key-data` with:
-->
{{< warning >}}
在透過 `kubeadm init` 建立的節點上，在 kubeadm 1.17 版本之前有一個
[缺陷](https://github.com/kubernetes/kubeadm/issues/1753)，該缺陷
使得你必須手動修改 `kubelet.conf` 檔案的內容。
`kubeadm init` 操作結束之後，你必須更新 `kubelet.conf` 檔案
將 `client-certificate-data` 和 `client-key-data` 改為如下所示的內容
以便使用輪換後的 kubelet 客戶端證書：

```yaml
client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem
client-key: /var/lib/kubelet/pki/kubelet-client-current.pem
```
{{< /warning >}}

<!--
## Automatic certificate renewal

kubeadm renews all the certificates during control plane [upgrade](/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/).
-->

## 自動更新證書 {#automatic-certificate-renewal}

kubeadm 會在控制面
[升級](/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/)
的時候更新所有證書。

<!--
This feature is designed for addressing the simplest use cases;
if you don't have specific requirements on certificate renewal and perform Kubernetes version upgrades regularly (less than 1 year in between each upgrade), kubeadm will take care of keeping your cluster up to date and reasonably secure.
-->
這個功能旨在解決最簡單的用例；如果你對此類證書的更新沒有特殊要求，
並且定期執行 Kubernetes 版本升級（每次升級之間的間隔時間少於 1 年），
則 kubeadm 將確保你的叢集保持最新狀態並保持合理的安全性。

<!--
It is a best practice to upgrade your cluster frequently in order to stay secure.
-->
{{< note >}}
最佳的做法是經常升級叢集以確保安全。
{{< /note >}}

<!--
If you have more complex requirements for certificate renewal, you can opt out from the default behavior by passing `--certificate-renewal=false` to `kubeadm upgrade apply` or to `kubeadm upgrade node`.
-->
如果你對證書更新有更復雜的需求，則可透過將 `--certificate-renewal=false` 傳遞給
`kubeadm upgrade apply` 或者 `kubeadm upgrade node`，從而選擇不採用預設行為。

<!--
Prior to kubeadm version 1.17 there is a [bug](https://github.com/kubernetes/kubeadm/issues/1818)
where the default value for `--certificate-renewal` is `false` for the `kubeadm upgrade node`
command. In that case, you should explicitly set `--certificate-renewal=true`.
-->
{{< warning >}}
kubeadm 在 1.17 版本之前有一個[缺陷](https://github.com/kubernetes/kubeadm/issues/1818)，
該缺陷導致 `kubeadm update node` 執行時 `--certificate-renewal` 的預設值被設定為 `false`。
在這種情況下，你需要顯式地設定 `--certificate-renewal=true`。
{{< /warning >}}

<!--
## Manual certificate renewal

You can renew your certificates manually at any time with the `kubeadm certs renew` command.
-->
## 手動更新證書 {#manual-certificate-renewal}

你能隨時透過 `kubeadm certs renew` 命令手動更新你的證書。

<!--
This command performs the renewal using CA (or front-proxy-CA) certificate and key stored in `/etc/kubernetes/pki`.

After running the command you should restart the control plane Pods. This is required since
dynamic certificate reload is currently not supported for all components and certificates.
[Static Pods](/docs/tasks/configure-pod-container/static-pod/) are managed by the local kubelet
and not by the API Server, thus kubectl cannot be used to delete and restart them.
To restart a static Pod you can temporarily remove its manifest file from `/etc/kubernetes/manifests/`
and wait for 20 seconds (see the `fileCheckFrequency` value in [KubeletConfiguration struct](/docs/reference/config-api/kubelet-config.v1beta1/).
The kubelet will terminate the Pod if it's no longer in the manifest directory.
You can then move the file back and after another `fileCheckFrequency` period, the kubelet will recreate
the Pod and the certificate renewal for the component can complete.
-->
此命令用 CA（或者 front-proxy-CA ）證書和儲存在 `/etc/kubernetes/pki` 中的金鑰執行更新。

執行完此命令之後你需要重啟控制面 Pods。因為動態證書過載目前還不被所有元件和證書支援，所有這項操作是必須的。
[靜態 Pods](/zh-cn/docs/tasks/configure-pod-container/static-pod/) 是被本地 kubelet 而不是 API Server 管理，
所以 kubectl 不能用來刪除或重啟他們。
要重啟靜態 Pod 你可以臨時將清單檔案從 `/etc/kubernetes/manifests/` 移除並等待 20 秒
（參考 [KubeletConfiguration 結構](/zh-cn/docs/reference/config-api/kubelet-config.v1beta1/) 中的`fileCheckFrequency` 值）。
如果 Pod 不在清單目錄裡，kubelet 將會終止它。
在另一個 `fileCheckFrequency` 週期之後你可以將檔案移回去，為了元件可以完成 kubelet 將重新建立 Pod 和證書更新。

<!--
If you are running an HA cluster, this command needs to be executed on all the control-plane nodes.
-->
{{< warning >}}
如果你運行了一個 HA 叢集，這個命令需要在所有控制面板節點上執行。
{{< /warning >}}

<!--
`certs renew` uses the existing certificates as the authoritative source for attributes (Common Name, Organization, SAN, etc.) instead of the kubeadm-config ConfigMap. It is strongly recommended to keep them both in sync.
-->
{{< note >}}
`certs renew` 使用現有的證書作為屬性（Common Name、Organization、SAN 等）的權威來源，
而不是 kubeadm-config ConfigMap。強烈建議使它們保持同步。
{{< /note >}}

<!--
`kubeadm certs renew` provides the following options:
-->
`kubeadm certs renew` 提供以下選項：

<!--
The Kubernetes certificates normally reach their expiration date after one year.
-->
Kubernetes 證書通常在一年後到期。

<!--
- `--csr-only` can be used to renew certificates with an external CA by generating certificate signing requests (without actually renewing certificates in place); see next paragraph for more information.
- It's also possible to renew a single certificate instead of all.
 -->

- `--csr-only` 可用於經過一個外部 CA 生成的證書籤名請求來更新證書（無需實際替換更新證書）；
  更多資訊請參見下節。
- 可以更新單個證書而不是全部證書。

<!--
## Renew certificates with the Kubernetes certificates API

This section provides more details about how to execute manual certificate renewal using the Kubernetes certificates API.
-->
## 用 Kubernetes 證書 API 更新證書 {#renew-certificates-with-the-kubernetes-certificates-api}

本節提供有關如何使用 Kubernetes 證書 API 執行手動證書更新的更多詳細資訊。

<!--
These are advanced topics for users who need to integrate their organization's certificate infrastructure into a kubeadm-built cluster. If the default kubeadm configuration satisfies your needs, you should let kubeadm manage certificates instead.
-->
{{< caution >}}
這些是針對需要將其組織的證書基礎結構整合到 kubeadm 構建的叢集中的使用者的高階主題。
如果預設的 kubeadm 配置滿足了你的需求，則應讓 kubeadm 管理證書。
{{< /caution >}}

<!--
### Set up a signer

The Kubernetes Certificate Authority does not work out of the box.
You can configure an external signer such as [cert-manager](https://cert-manager.io/docs/configuration/ca/), or you can use the built-in signer.
The built-in signer is part of [`kube-controller-manager`](/docs/reference/command-line-tools-reference/kube-controller-manager/).
To activate the built-in signer, you must pass the `--cluster-signing-cert-file` and `--cluster-signing-key-file` flags.
-->

### 設定一個簽名者（Signer） {#set-up-a-signer}

Kubernetes 證書頒發機構不是開箱即用。你可以配置外部簽名者，例如 [cert-manager](https://cert-manager.io/docs/configuration/ca/)，
也可以使用內建簽名者。
內建簽名者是
[`kube-controller-manager`](/zh-cn/docs/reference/command-line-tools-reference/kube-controller-manager/) 的一部分。
要啟用內建簽名者，請傳遞 `--cluster-signing-cert-file` 和 `--cluster-signing-key-file` 引數。

<!--
If you're creating a new cluster, you can use a kubeadm [configuration file](https://pkg.go.dev/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta3):
-->
如果你正在建立一個新的叢集，你可以使用 kubeadm 的
[配置檔案](/zh-cn/docs/reference/config-api/kubeadm-config.v1beta3/)。

```yaml
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
controllerManager:
  extraArgs:
    cluster-signing-cert-file: /etc/kubernetes/pki/ca.crt
    cluster-signing-key-file: /etc/kubernetes/pki/ca.key
```

<!--
### Create certificate signing requests (CSR)
-->
### 建立證書籤名請求 (CSR) {#create-certificate-signing-requests-csr}

<!--
See [Create CertificateSigningRequest](/docs/reference/access-authn-authz/certificate-signing-requests/#create-certificatesigningrequest) for creating CSRs with the Kubernetes API.
-->
有關使用 Kubernetes API 建立 CSR 的資訊，
請參見[建立 CertificateSigningRequest](/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests/#create-certificatesigningrequest)。

<!--
## Renew certificates with external CA

This section provide more details about how to execute manual certificate renewal using an external CA.
-->
## 透過外部 CA 更新證書 {#renew-certificates-with-external-ca}

本節提供有關如何使用外部 CA 執行手動更新證書的更多詳細資訊。

<!--
To better integrate with external CAs, kubeadm can also produce certificate signing requests (CSRs).
A CSR represents a request to a CA for a signed certificate for a client.
In kubeadm terms, any certificate that would normally be signed by an on-disk CA can be produced as a CSR instead. A CA, however, cannot be produced as a CSR.
-->
為了更好的與外部 CA 整合，kubeadm 還可以生成證書籤名請求（CSR）。
CSR 表示向 CA 請求客戶的簽名證書。
在 kubeadm 術語中，通常由磁碟 CA 簽名的任何證書都可以作為 CSR 生成。但是，CA 不能作為 CSR 生成。

<!--
### Create certificate signing requests (CSR)

You can create certificate signing requests with `kubeadm certs renew --csr-only`.

Both the CSR and the accompanying private key are given in the output.
You can pass in a directory with `--csr-dir` to output the CSRs to the specified location.
If `--csr-dir` is not specified, the default certificate directory (`/etc/kubernetes/pki`) is used.
-->
### 建立證書籤名請求 (CSR) {#create-certificate-signing-requests-csr-1}

你可以透過 `kubeadm certs renew --csr-only` 命令建立證書籤名請求。

CSR 和隨附的私鑰都在輸出中給出。
你可以傳入一個帶有 `--csr-dir` 的目錄，將 CRS 輸出到指定位置。
如果未指定 `--csr-dir`，則使用預設證書目錄（`/etc/kubernetes/pki`）。

<!--
Certificates can be renewed with `kubeadm certs renew --csr-only`.
As with `kubeadm init`, an output directory can be specified with the `--csr-dir` flag.
-->
證書可以透過 `kubeadm certs renew --csr-only` 來續訂。
和 `kubeadm init` 一樣，可以使用 `--csr-dir` 標誌指定一個輸出目錄。

CSR 簽署證書後，必須將證書和私鑰複製到 PKI 目錄（預設情況下為 `/etc/kubernetes/pki`）。

<!--
A CSR contains a certificate's name, domains, and IPs, but it does not specify usages.
It is the responsibility of the CA to specify [the correct cert usages](/docs/setup/best-practices/certificates/#all-certificates)
when issuing a certificate.
-->
CSR 中包含一個證書的名字，域和 IP，但是未指定用法。
頒發證書時，CA 有責任指定[正確的證書用法](/zh-cn/docs/setup/best-practices/certificates/#all-certificates)

<!--
* In `openssl` this is done with the
  [`openssl ca` command](https://superuser.com/questions/738612/openssl-ca-keyusage-extension).
* In `cfssl` you specify
  [usages in the config file](https://github.com/cloudflare/cfssl/blob/master/doc/cmd/cfssl.txt#L170).
-->
* 在 `openssl` 中，這是透過
  [`openssl ca` 命令](https://superuser.com/questions/738612/openssl-ca-keyusage-extension)
  來完成的。
* 在 `cfssl` 中，這是透過
  [在配置檔案中指定用法](https://github.com/cloudflare/cfssl/blob/master/doc/cmd/cfssl.txt#L170)
  來完成的。

<!--
After a certificate is signed using your preferred method, the certificate and the private key must be copied to the PKI directory (by default `/etc/kubernetes/pki`).
-->
使用首選方法對證書籤名後，必須將證書和私鑰複製到 PKI 目錄（預設為 `/etc/kubernetes/pki` ）。

<!--
## Certificate authority (CA) rotation {#certificate-authority-rotation}

Kubeadm does not support rotation or replacement of CA certificates out of the box.

For more information about manual rotation or replacement of CA, see [manual rotation of CA certificates](/docs/tasks/tls/manual-rotation-of-ca-certificates/).
-->
## 證書機構（CA）輪換 {#certificate-authority-rotation}

kubeadm 並不直接支援對 CA 證書的輪換或者替換。

關於手動輪換或者置換 CA 的更多資訊，可參閱
[手動輪換 CA 證書](/zh-cn/docs/tasks/tls/manual-rotation-of-ca-certificates/)。

<!--
## Enabling signed kubelet serving certificates {#kubelet-serving-certs}

By default the kubelet serving certificate deployed by kubeadm is self-signed.
This means a connection from external services like the
[metrics-server](https://github.com/kubernetes-sigs/metrics-server) to a
kubelet cannot be secured with TLS.

To configure the kubelets in a new kubeadm cluster to obtain properly signed serving
certificates you must pass the following minimal configuration to `kubeadm init`:
-->
## 啟用已簽名的 kubelet 服務證書 {#kubelet-serving-certs}

預設情況下，kubeadm 所部署的 kubelet 服務證書是自簽名（Self-Signed）。
這意味著從 [metrics-server](https://github.com/kubernetes-sigs/metrics-server)
這類外部服務發起向 kubelet 的連結時無法使用 TLS 來完成保護。

要在新的 kubeadm 叢集中配置 kubelet 以使用被正確簽名的服務證書，
你必須向 `kubeadm init` 傳遞如下最小配置資料：

```yaml
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
serverTLSBootstrap: true
```

<!--
If you have already created the cluster you must adapt it by doing the following:
 - Find and edit the `kubelet-config-{{< skew latestVersion >}}` ConfigMap in the `kube-system` namespace.
In that ConfigMap, the `kubelet` key has a
[KubeletConfiguration](/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)
document as its value. Edit the KubeletConfiguration document to set `serverTLSBootstrap: true`.
- On each node, add the `serverTLSBootstrap: true` field in `/var/lib/kubelet/config.yaml`
and restart the kubelet with `systemctl restart kubelet`
-->
如果你已經建立了叢集，你必須透過執行下面的操作來完成適配：

- 找到 `kube-system` 名字空間中名為 `kubelet-config-{{< skew latestVersion >}}`
  的 ConfigMap 並編輯之。
  在該 ConfigMap 中，`kubelet` 鍵下面有一個
  [KubeletConfiguration](/zh-cn/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)
  文件作為其取值。編輯該 KubeletConfiguration 文件以設定
  `serverTLSBootstrap: true`。
- 在每個節點上，在 `/var/lib/kubelet/config.yaml` 檔案中新增
  `serverTLSBootstrap: true` 欄位，並使用 `systemctl restart kubelet`
  來重啟 kubelet。

<!--
The field `serverTLSBootstrap: true` will enable the bootstrap of kubelet serving
certificates by requesting them from the `certificates.k8s.io` API. One known limitation
is that the CSRs (Certificate Signing Requests) for these certificates cannot be automatically
approved by the default signer in the kube-controller-manager -
[`kubernetes.io/kubelet-serving`](/docs/reference/access-authn-authz/certificate-signing-requests/#kubernetes-signers).
This will require action from the user or a third party controller.

These CSRs can be viewed using:
-->
欄位 `serverTLSBootstrap` 將允許啟動引導 kubelet 的服務證書，方式
是從 `certificates.k8s.io` API 處讀取。這種方式的一種侷限在於這些
證書的 CSR（證書籤名請求）不能被 kube-controller-manager 中預設的
簽名元件
[`kubernetes.io/kubelet-serving`](/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests/#kubernetes-signers)
批准。需要使用者或者第三方控制器來執行此操作。

可以使用下面的命令來檢視 CSR：

```shell
kubectl get csr
```

```none
NAME        AGE     SIGNERNAME                        REQUESTOR                      CONDITION
csr-9wvgt   112s    kubernetes.io/kubelet-serving     system:node:worker-1           Pending
csr-lz97v   1m58s   kubernetes.io/kubelet-serving     system:node:control-plane-1    Pending
```

<!--
To approve them you can do the following:
-->
你可以執行下面的操作來批准這些請求：

```shell
kubectl certificate approve <CSR-名稱>
```

<!--
By default, these serving certificate will expire after one year. Kubeadm sets the
`KubeletConfiguration` field `rotateCertificates` to `true`, which means that close
to expiration a new set of CSRs for the serving certificates will be created and must
be approved to complete the rotation. To understand more see
[Certificate Rotation](/docs/reference/access-authn-authz/kubelet-tls-bootstrapping/#certificate-rotation).
-->
預設情況下，這些服務證書上會在一年後過期。
kubeadm 將 `KubeletConfiguration` 的 `rotateCertificates` 欄位設定為
`true`；這意味著證書快要過期時，會生成一組針對服務證書的新的 CSR，而
這些 CSR 也要被批准才能完成證書輪換。
要進一步瞭解這裡的細節，可參閱
[證書輪換](/zh-cn/docs/reference/access-authn-authz/kubelet-tls-bootstrapping/#certificate-rotation)
文件。

<!--
If you are looking for a solution for automatic approval of these CSRs it is recommended
that you contact your cloud provider and ask if they have a CSR signer that verifies
the node identity with an out of band mechanism.
-->
如果你在尋找一種能夠自動批准這些 CSR 的解決方案，建議你與你的雲提供商
聯絡，詢問他們是否有 CSR 簽名元件，用來以帶外（out-of-band）的方式檢查
節點的識別符號。

{{% thirdparty-content %}}

<!--
Third party custom controllers can be used:
- [kubelet-csr-approver](https://github.com/postfinance/kubelet-csr-approver)

Such a controller is not a secure mechanism unless it not only verifies the CommonName
in the CSR but also verifies the requested IPs and domain names. This would prevent
a malicious actor that has access to a kubelet client certificate to create
CSRs requesting serving certificates for any IP or domain name.
-->
也可以使用第三方定製的控制器：

- [kubelet-csr-approver](https://github.com/postfinance/kubelet-csr-approver)

除非既能夠驗證 CSR 中的 CommonName，也能檢查請求的 IP 和域名，
這類控制器還算不得安全的機制。
只有完成徹底的檢查，才有可能避免有惡意的、能夠訪問 kubelet 客戶端證書的第三方
為任何 IP 或域名請求服務證書。

<!--
## Generating kubeconfig files for additional users {#kubeconfig-additional-users}
-->
## 為其他使用者生成 kubeconfig 檔案 {#kubeconfig-additional-users}

<!--
During cluster creation, kubeadm signs the certificate in the `admin.conf` to have
`Subject: O = system:masters, CN = kubernetes-admin`.
[`system:masters`](/docs/reference/access-authn-authz/rbac/#user-facing-roles)
is a break-glass, super user group that bypasses the authorization layer (e.g. RBAC).
Sharing the `admin.conf` with additional users is **not recommended**!
-->
在叢集建立過程中，kubeadm 對 `admin.conf` 中的證書進行簽名時，將其配置為
`Subject: O = system:masters, CN = kubernetes-admin`。
[`system:masters`](/zh-cn/docs/reference/access-authn-authz/rbac/#user-facing-roles)
是一個例外的超級使用者組，可以繞過鑑權層（例如 RBAC）。
強烈建議不要將 `admin.conf` 檔案與任何人共享。

<!--
Instead, you can use the [`kubeadm kubeconfig user`](/docs/reference/setup-tools/kubeadm/kubeadm-kubeconfig)
command to generate kubeconfig files for additional users.
The command accepts a mixture of command line flags and
[kubeadm configuration](/docs/reference/config-api/kubeadm-config.v1beta3/) options.
The generated kubeconfig will be written to stdout and can be piped to a file
using `kubeadm kubeconfig user ... > somefile.conf`.
-->
你要使用 [`kubeadm kubeconfig user`](/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-kubeconfig)
命令為其他使用者生成 kubeconfig 檔案，這個命令支援命令列引數和
[kubeadm 配置結構](/zh-cn/docs/reference/config-api/kubeadm-config.v1beta3/)。
以上命令會將 kubeconfig 列印到終端上，也可以使用 `kubeadm kubeconfig user ... > somefile.conf`
輸出到一個檔案中。

<!--
Example configuration file that can be used with `--config`:
-->
如下 kubeadm 可以在 `--config` 後加的配置檔案示例：

```yaml
# example.yaml
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
# kubernetes 將作為 kubeconfig 中叢集名稱
clusterName: "kubernetes"
# some-dns-address:6443 將作為叢集 kubeconfig 檔案中服務地址（IP 或者 DNS 名稱）
controlPlaneEndpoint: "some-dns-address:6443"
# 從本地掛載叢集的 CA 秘鑰和 CA 證書
certificatesDir: "/etc/kubernetes/pki"
```

<!--
Make sure that these settings match the desired target cluster settings.
To see the settings of an existing cluster use:
-->
確保這些設定與所需的目標叢集設定相匹配。可以使用以下命令檢視現有叢集的設定：

```shell
kubectl get cm kubeadm-config -n kube-system -o=jsonpath="{.data.ClusterConfiguration}"
```

<!--
The following example will generate a kubeconfig file with credentials valid for 24 hours
for a new user `johndoe` that is part of the `appdevs` group:
-->
以下示例將為在 `appdevs` 組的 `johndoe` 使用者建立一個有效期為 24 小時的 kubeconfig 檔案：

```shell
kubeadm kubeconfig user --config example.yaml --org appdevs --client-name johndoe --validity-period 24h
```

<!--
The following example will generate a kubeconfig file with administrator credentials valid for 1 week:
-->
以下示例將為管理員建立一個有效期有一週的 kubeconfig 檔案：

```shell
kubeadm kubeconfig user --config example.yaml --client-name admin --validity-period 168h
```