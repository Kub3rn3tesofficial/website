---
title: " 使用 Puppet 管理 Kubernetes Pods，Services 和 Replication Controllers "
date: 2015-12-17
slug: managing-kubernetes-pods-services-and-replication-controllers-with-puppet
---

<!--
---
title: " Managing Kubernetes Pods, Services and Replication Controllers with Puppet "
date: 2015-12-17
slug: managing-kubernetes-pods-services-and-replication-controllers-with-puppet
url: /zh-cn/blog/2015/12/Managing-Kubernetes-Pods-Services-And-Replication-Controllers-With-Puppet
---
-->

<!--
_Today’s guest post is written by Gareth Rushgrove, Senior Software Engineer at Puppet Labs, a leader in IT automation. Gareth tells us about a new Puppet module that helps manage resources in Kubernetes.&nbsp;_

People familiar with [Puppet](https://github.com/puppetlabs/puppet)&nbsp;might have used it for managing files, packages and users on host computers. But Puppet is first and foremost a configuration management tool, and config management is a much broader discipline than just managing host-level resources. A good definition of configuration management is that it aims to solve four related problems: identification, control, status accounting and verification and audit. These problems exist in the operation of any complex system, and with the new [Puppet Kubernetes module](https://forge.puppetlabs.com/garethr/kubernetes)&nbsp;we’re starting to look at how we can solve those problems for Kubernetes.
-->

_今天的嘉賓帖子是由 IT 自動化領域的領導者 Puppet Labs 的高階軟體工程師 Gareth Rushgrove 撰寫的。Gareth告訴我們一個新的 Puppet 模組，它幫助管理 Kubernetes 中的資源。_

熟悉[Puppet]的人(https://github.com/puppetlabs/puppet)可能使用它來管理主機上的檔案、包和使用者。但是Puppet首先是一個配置管理工具，配置管理是一個比管理主機級資源更廣泛的規程。配置管理的一個很好的定義是它旨在解決四個相關的問題：標識、控制、狀態核算和驗證審計。這些問題存在於任何複雜系統的操作中，並且有了新的[Puppet Kubernetes module](https://forge.puppetlabs.com/garethr/kubernetes)，我們開始研究如何為 Kubernetes 解決這些問題。

<!--
### The Puppet Kubernetes Module

The Puppet Kubernetes module currently assumes you already have a Kubernetes cluster [up and running](http://kubernetes.io/gettingstarted/).&nbsp;Its focus is on managing the resources in Kubernetes, like Pods, Replication Controllers and Services, not (yet) on managing the underlying kubelet or etcd services. Here’s a quick snippet of code describing a Pod in Puppet’s DSL.
-->

### Puppet Kubernetes 模組

Puppet kubernetes 模組目前假設您已經有一個 kubernetes 叢集 [啟動並執行]](http://kubernetes.io/gettingstarted/)。它的重點是管理 Kubernetes中的資源，如 Pods、Replication Controllers 和 Services，而不是（現在）管理底層的 kubelet 或 etcd services。下面是描述 Puppet’s DSL 中一個 Pod 的簡短程式碼片段。

<!--
```
kubernetes_pod { 'sample-pod':
  ensure => present,
  metadata => {
    namespace => 'default',
  },
  spec => {
    containers => [{
      name => 'container-name',
      image => 'nginx',
    }]
  },
```
}
-->

```
kubernetes_pod { 'sample-pod':
  ensure => present,
  metadata => {
    namespace => 'default',
  },
  spec => {
    containers => [{
      name => 'container-name',
      image => 'nginx',
    }]
  },
}
```
<!--
If you’re familiar with the YAML file format, you’ll probably recognise the structure immediately. The interface is intentionally identical to aid conversion between different formats — in fact, the code powering this is autogenerated from the Kubernetes API Swagger definitions. Running the above code, assuming we save it as pod.pp, is as simple as:


```
puppet apply pod.pp
```
-->

如果您熟悉 YAML 檔案格式，您可能會立即識別該結構。 該介面故意採取相同的格式以幫助在不同格式之間進行轉換 — 事實上，為此提供支援的程式碼是從Kubernetes API Swagger自動生成的。 執行上面的程式碼，假設我們將其儲存為 pod.pp，就像下面這樣簡單：


```
puppet apply pod.pp
```

<!--
Authentication uses the standard kubectl configuration file. You can find complete [installation instructions in the module's README](https://github.com/garethr/garethr-kubernetes/blob/master/README.md).

Kubernetes has several resources, from Pods and Services to Replication Controllers and Service Accounts. You can see an example of the module managing these resources in the [Kubernetes guestbook sample in Puppet](https://puppetlabs.com/blog/kubernetes-guestbook-example-puppet)&nbsp;post. This demonstrates converting the canonical hello-world example to use Puppet code.  -->

身份驗證使用標準的 kubectl 配置檔案。您可以在模組的自述檔案中找到完整的[README](https://github.com/garethr/garethr-kubernetes/blob/master/README.md)。

Kubernetes 有很多資源，來自 Pods、 Services、 Replication Controllers 和 Service Accounts。您可以在[Puppet 中的 kubernetes 留言簿示例](https://puppetlabs.com/blog/kubernetes-guestbook-example-puppet)文章中看到管理這些資源的模組示例。這演示瞭如何將規範的 hello-world 示例轉換為使用 Puppet程式碼。

<!--
One of the main advantages of using Puppet for this, however, is that you can create your own higher-level and more business-specific interfaces to Kubernetes-managed applications. For instance, for the guestbook, you could create something like the following:


```
guestbook { 'myguestbook':
  redis_slave_replicas => 2,
  frontend_replicas => 3,
  redis_master_image => 'redis',
  redis_slave_image => 'gcr.io/google_samples/gb-redisslave:v1',
  frontend_image => 'gcr.io/google_samples/gb-frontend:v3',
}
```
-->

然而，使用 Puppet 的一個主要優點是，您可以建立自己的更高級別和更特定於業務的介面，以連線 kubernetes 管理的應用程式。例如，對於留言簿，可以建立如下內容：

```
guestbook { 'myguestbook':
  redis_slave_replicas => 2,
  frontend_replicas => 3,
  redis_master_image => 'redis',
  redis_slave_image => 'gcr.io/google_samples/gb-redisslave:v1',
  frontend_image => 'gcr.io/google_samples/gb-frontend:v3',
}
```

<!--
You can read more about using Puppet’s defined types, and see lots more code examples, in the Puppet blog post, [Building Your Own Abstractions for Kubernetes in Puppet](https://puppetlabs.com/blog/building-your-own-abstractions-kubernetes-puppet).


### Conclusions

The advantages of using Puppet rather than just the standard YAML files and kubectl are:
-->

您可以在Puppet部落格文章[在 Puppet 中為 Kubernetes 構建自己的抽象](https://puppetlabs.com/blog/building-your-own-abstractions-kubernetes-puppet)中閱讀更多關於使用 Puppet 定義的型別的資訊，並看到更多的程式碼示例。


### 結論

使用 Puppet 而不僅僅是使用標準的 YAML 檔案和 kubectl 的優點是：

<!--
- The ability to create your own abstractions to cut down on repetition and craft higher-level user interfaces, like the guestbook example above.&nbsp;
- Use of Puppet’s development tools for validating code and for writing unit tests.&nbsp;
- Integration with other tools such as Puppet Server, for ensuring that your model in code matches the state of your cluster, and with PuppetDB for storing reports and tracking changes.
- The ability to run the same code repeatedly against the Kubernetes API, to detect any changes or remediate configuration drift.&nbsp;
-->

- 能夠建立自己的抽象，以減少重複和設計更高級別的使用者介面，如上面的留言簿示例。
- 使用 Puppet 的開發工具驗證程式碼和編寫單元測試。
- 與 Puppet Server 等其他工具配合，以確保程式碼中的模型與叢集的狀態匹配，並與 PuppetDB 配合工作，以儲存報告和跟蹤更改。
- 能夠針對 Kubernetes API 重複執行相同的程式碼，以檢測任何更改或修正配置。

<!--
It’s also worth noting that most large organisations will have very heterogenous environments, running a wide range of software and operating systems. Having a single toolchain that unifies those discrete systems can make adopting new technology like Kubernetes much easier.
-->

值得注意的是，大多數大型組織都將擁有非常異構的環境，執行各種各樣的軟體和作業系統。擁有統一這些離散系統的單一工具鏈可以使採用 Kubernetes 等新技術變得更加容易。

<!--
It’s safe to say that Kubernetes provides an excellent set of primitives on which to build cloud-native systems. And with Puppet, you can address some of the operational and configuration management issues that come with running any complex system in production. [Let us know](mailto:gareth@puppetlabs.com)&nbsp;what you think if you try the module out, and what else you’d like to see supported in the future.

&nbsp;-&nbsp;Gareth Rushgrove, Senior Software Engineer, Puppet Labs
-->

可以肯定地說，Kubernetes提供了一組優秀的元件來構建雲原生系統。使用 Puppet，您可以解決在生產中執行任何複雜系統所帶來的一些操作和配置管理問題。[告訴我們](mailto:gareth@puppetlabs.com)如果您試用了該模組，您會有什麼想法，以及您希望在將來看到哪些支援。


Gareth Rushgrove，Puppet Labs 高階軟體工程師

